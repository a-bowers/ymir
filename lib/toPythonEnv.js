"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function headerToWSGIVar(header) {
    return `HTTP_${header.replace(/\-/g, '_').toUpperCase()}`;
}
exports.headerToWSGIVar = headerToWSGIVar;
function toPythonEnv(req) {
    const env = {};
    const { socket } = req;
    const isUnixDomainSocket = typeof socket.address() === 'string';
    env.SCRIPT_NAME = req.baseUrl;
    env.REQUEST_METHOD = req.method;
    env.PATH = req.path;
    env.QUERY_STRING = req.originalUrl.split('?')[1] || '';
    env.CONTENT_TYPE = req.headers['content-type'] || '';
    env.CONTENT_LENGTH = req.headers['content-length'] || '';
    env.SERVER_NAME = isUnixDomainSocket ? '' : socket.localAddress;
    env.SERVER_PORT = isUnixDomainSocket ? '' : socket.localPort.toString(10);
    env.SERVER_PROTOCOL = `HTTP/${req.httpVersion}`;
    env.HTTPS = req.secure ? 'on' : 'off';
    env['wsgi.url_scheme'] = req.protocol;
    for (const header of Object.keys(req.headers)) {
        env[headerToWSGIVar(header)] = req.headers[header] || '';
    }
    Object.assign(env, process.env);
    return env;
}
exports.toPythonEnv = toPythonEnv;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9QeXRob25FbnYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdG9QeXRob25FbnYudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUEwQ0EseUJBQWdDLE1BQWM7SUFDMUMsT0FBTyxRQUFRLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUM7QUFDOUQsQ0FBQztBQUZELDBDQUVDO0FBRUQscUJBQTRCLEdBQWM7SUFDdEMsTUFBTSxHQUFHLEdBQWUsRUFBUyxDQUFDO0lBQ2xDLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUM7SUFDdkIsTUFBTSxrQkFBa0IsR0FBRyxPQUFPLE1BQU0sQ0FBQyxPQUFPLEVBQUUsS0FBSyxRQUFRLENBQUM7SUFFaEUsR0FBRyxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDO0lBQzlCLEdBQUcsQ0FBQyxjQUFjLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztJQUNoQyxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDcEIsR0FBRyxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDdkQsR0FBRyxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNyRCxHQUFHLENBQUMsY0FBYyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLENBQUM7SUFHekQsR0FBRyxDQUFDLFdBQVcsR0FBRyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO0lBQ2hFLEdBQUcsQ0FBQyxXQUFXLEdBQUcsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDMUUsR0FBRyxDQUFDLGVBQWUsR0FBRyxRQUFRLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUVoRCxHQUFHLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBSXRDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxRQUF3QixDQUFDO0lBRXRELEtBQUssTUFBTSxNQUFNLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDM0MsR0FBRyxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0tBQzVEO0lBR0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRWhDLE9BQU8sR0FBRyxDQUFDO0FBQ2YsQ0FBQztBQS9CRCxrQ0ErQkMifQ==