"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const python_1 = require("./python");
function headerToWSGIVar(header) {
    return `HTTP_${header.replace(/\-/g, '_').toUpperCase()}`;
}
exports.headerToWSGIVar = headerToWSGIVar;
function toPythonEnv(req) {
    const env = {};
    const { socket } = req;
    const isUnixDomainSocket = typeof socket.address() === 'string';
    env.SCRIPT_NAME = req.baseUrl;
    env.REQUEST_METHOD = req.method;
    env.PATH = req.path;
    env.QUERY_STRING = req.originalUrl.split('?')[1] || '';
    env.CONTENT_TYPE = req.headers['content-type'] || '';
    env.CONTENT_LENGTH = req.headers['content-length'] || '';
    env.SERVER_NAME = isUnixDomainSocket ? '' : socket.localAddress;
    env.SERVER_PORT = isUnixDomainSocket ? '' : socket.localPort.toString(10);
    env.SERVER_PROTOCOL = `HTTP/${req.httpVersion}`;
    env.HTTPS = req.secure ? 'on' : 'off';
    const body = new python_1.BytesIOStream();
    env['wsgi.url_scheme'] = req.protocol;
    env['wsgi.input'] = body.ref;
    req.pipe(body);
    for (const header of Object.keys(req.headers)) {
        env[headerToWSGIVar(header)] = req.headers[header] || '';
    }
    Object.assign(env, process.env);
    return env;
}
exports.toPythonEnv = toPythonEnv;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9QeXRob25FbnYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdG9QeXRob25FbnYudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFHQSxxQ0FBeUM7QUF5Q3pDLHlCQUFnQyxNQUFjO0lBQzFDLE9BQU8sUUFBUSxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDO0FBQzlELENBQUM7QUFGRCwwQ0FFQztBQUVELHFCQUE0QixHQUFjO0lBQ3RDLE1BQU0sR0FBRyxHQUFlLEVBQVMsQ0FBQztJQUNsQyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDO0lBQ3ZCLE1BQU0sa0JBQWtCLEdBQUcsT0FBTyxNQUFNLENBQUMsT0FBTyxFQUFFLEtBQUssUUFBUSxDQUFDO0lBRWhFLEdBQUcsQ0FBQyxXQUFXLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQztJQUM5QixHQUFHLENBQUMsY0FBYyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7SUFDaEMsR0FBRyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO0lBQ3BCLEdBQUcsQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3ZELEdBQUcsQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDckQsR0FBRyxDQUFDLGNBQWMsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxDQUFDO0lBR3pELEdBQUcsQ0FBQyxXQUFXLEdBQUcsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQztJQUNoRSxHQUFHLENBQUMsV0FBVyxHQUFHLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzFFLEdBQUcsQ0FBQyxlQUFlLEdBQUcsUUFBUSxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUM7SUFFaEQsR0FBRyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUl0QyxNQUFNLElBQUksR0FBRyxJQUFJLHNCQUFhLEVBQUUsQ0FBQztJQUVqQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsR0FBRyxHQUFHLENBQUMsUUFBd0IsQ0FBQztJQUN0RCxHQUFHLENBQUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUU3QixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWYsS0FBSyxNQUFNLE1BQU0sSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRTtRQUMzQyxHQUFHLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7S0FDNUQ7SUFHRCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFaEMsT0FBTyxHQUFHLENBQUM7QUFDZixDQUFDO0FBcENELGtDQW9DQyJ9